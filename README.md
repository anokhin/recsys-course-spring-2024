# Домашнее задание 2.

## 1. Идея эксперимента

Для улучшения сервиса botify и повышения метрики mean_session_time был предложен новый рекоммендер. Он основывается на контексте последнего трека, прослушанного пользователем. Если пользователь положительно реагирует на последний прослушанный трек, то рекоммендуется контекстная рекомендация, иначе - персональная рекомендация. 

## 2. Детали

Был добавлен новый класс под названием [ContextualMod](botify/botify/recommenders/contextualmod.py), который реализует логику выдачи рекомендаций на основе контекста последнего трека пользователя.
Логика рекомендаций: Если время прослушивания предыдущего трека пользователя меньше 50%, то рекомендуются персональные рекомендации из DSSM. Если же время прослушивания больше порога, то используются контекстные рекомендации.

## 3. Результаты A/B эксперимента

Был добавлен эксперимент, в котором проводилось сравнение двух моделей: DSSM с лекции в контрольной группе и новый рекоммендер в тестовой группе. Эксперимент был запущен на симуляторе с 4000 эпизодов.
Для быстроты исполнения теста данные лежат в (/script/cache)
[Результат](results.png)

## 4. Инструкции

У меня Win11 c симуляцией conda, поэтому оставляю инструкцию для нее. Также использовал последнюю версию gym и танцевал с бубном.
В остальном программа запускается, тестируется и используется согласно описанию на семинарах, а также в выложенных Readme:

1. Запустить botify: 
```
docker-compose up -d --build --force-recreate --scale recommender=2
```
2. Запустить sim
```
conda create -n recsys-2024 python==3.8
conda activate recsys-2024
pip install -r requirements.txt
python -m sim.run --episodes 10000 --config config/env.yml single --recommender remote --seed 31337 
```
3. Забрать данные
```
python dataclient.py --recommender 2 log2local ./cache/
```
4. Посмотреть результаты в [Week1Seminar.ipynb](jupyter/Week1Seminar.ipynb)
