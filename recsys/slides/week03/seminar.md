# Семинар 3. Персонализированные рекомендации

На этом семинаре мы применим библиотеку LightFM для построения персонализированного рекомендера треков. 

### План действий

1. Используем ноутбук `Week3SeminarData.ipynb`, для того, чтобы собрать данные для обучения рекомендера
    1. Выгружаем только позитивные интеракции user-track со временем прослушивания больше 0.5
        
2.  Используем ноутбук `Week3SeminarModel.ipynb`, для того, чтобы собрать данные для обучения рекомендера
    1. Загружаем сохраненные в предыдущем пункте данные в `Dataset` LightFM
    2. Перебираем гиперпараметры модели с помощью пакета `optuna`
    3. Обучаем модель с лучшими гиперпараметрами
    4. Смотрим на полученные эмбеддинги в tensorboard
    5. Выгружаем top-100 рекомендованных треков для пользователей
    
3. Реализуем новый рекомендер `Indexed`, который будет выдавать персонализированные рекомендации
    1. Загружаем рекомендации в новую базу `Redis`
    2. При идем в базу рекомендаций и достаем рекомендации по пользователю
    3. Если рекомендаций не нашлось, то возвращаем случайные
    
3. Создаем A/B эксперимент.
    1. В `botify.experiment.Experiments` создаем эксперимент `PERSONALIZED`.
    2. В `botify.server.NextTrack` используем этот эксперимент для выбора рекомендера между `Random` и `Indexes`.
    3. Запускаем рекомендер и симулятор.
    4. Загружаем логи сервиса на HDFS.
   
4. Используем ноутбук `Week1Seminar.ipynb` для анализа.
    1. Запускаем анализатор для эксперимента `PERSONALIZED`.

### Задачки

#### Контентные рекомендации

Пользователь интересовался товарами Aliexpress

1. `Приманка для рыбалки, воблер с глазами, искусственная приманка, для пластиковой твердой приманки, набор рыболовных снастей`
2. `Джиг воблеры черви мягкие силиконовые приманки рыбный запах искусственные приманки плавающие приманки для окуня карпа рыболовные снасти`

Какой товар предложит этому пользователю контентный рекомендер?

1. `Мягкая приманка ARDEA пластиковая приманка в виде червя, силиконовая приманка в виде личинки, воблеры, приманки, искусственные приманки на окуня и щуку`
2. `Мягкая резиновая приманка Рыболовные приманки Джиг Воблер Мягкий червь Карп Рыбалка приманки Искусственный силиконовый`
3. `Приманка для рыбалки, качественная блесна, 3D глаза, пластиковая жесткая приманка, искусственный джиг, воблеры, приманка для рыбалки`

Товары представляются BOW-моделью на нормализованных токенах. Учитывается только наличие слова в описании, но не количество вхождений.
Профиль пользователя формируется усреднением профилей товаров, которыми интересовался пользователь.
Близость определяется по косинусному расстоянию.

#### User-based рекомендер

Дана матрица ретингов пользователей.

![Utility matrix](./images/exercise2.png)

Считаем рейтинги 3, 4 и 5 как положительные, а 1, 2 и пусто1 - как отрицательные. Вычислите расстояние жаккара между всеми парами пользователей.

#### TimeSVD

Допустим, качество айтемов эволюционирует по времени. Модель timeSVD учитывает это в bias b_i(t). Предложите примеры обучаемых функций b_i(t), которые могли бы выучить эту эволюцию.