# Homework 2

## Основная идея

У нас есть довольно много уже хороших рекоммендеров, поэтому наиболее эффективная стратегия - создать ансамбль из полученных рекоммендеров.
Одни из самых интересных фичей для нас - `prev_track` и `prev_track_time`, благодаря ним будут применяться те или иные веса для каждой модели.
Возьмем такие модели:
1. DSSM
2. LightFM, обученная на практике
3. LightFM, топовая модель на первом домашнем задании


## Реализация

Во первых будем делать весовой ансамбль из двух LightFM раставляя у каждого трека вес пропорциональный его месту, т.е. вероятности. Затем выбирать из треков выбирать `topk` рандомных и брать из них трек с максимальным весом.
Во вторых будет занулять вклад ансамбля из LightFM когда `prev_track_time` хотя бы средний, так как у нас есть от чего отталкиваться и лучше использоваться DSSM.
В третьих у DSSM в первую очередь будем брать треки похожие на предыдущий с помощью того же значения `topk` и только в крайнем случае будем выбирать рандомный.

## Код

В `hw/trainLightFM.ipynb` лежит код обучения топовой модели LightFM с генерацией файла рекомендаций 

* В `botify/config.json` добавил свой файл рекомендаций от топового LightFM
* В `botify/recommenders/ensemble.py` добавил свой рекоммендер 
* В `botify/experiment.py` добавил эксперимент со своим рекоммендером 
* В `botify/server.py` добавил инициализацию своего рекоммендера


## Воспроизведение результатов

Запускаем контейнер
```bash
cd botify
docker-compose up -d --build --force-recreate --scale recommender=1
```

Запускаем генерацию
```bash
cd ../sim
python -m sim.run --episodes 5000 --config config/env.yml single --recommender remote --seed 31337 
```

Переносим файл

```bash
docker cp botify-recommender-1:/app/log/ ../hw/hw_report_data
```

Остановим контейнер
```bash
cd ../botify
docker-compose stop
```

Запустить ноутбук `ab_test.ipynb` с A/B тестом

## Результат

Поставленная задача успешна выполнена:



